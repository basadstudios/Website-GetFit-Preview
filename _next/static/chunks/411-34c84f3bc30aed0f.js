"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{2353:(e,r,a)=>{a.d(r,{A:()=>u,d:()=>d});var t=a(5155),s=a(2115),o=a(760),n=a(9582),l=a(351);let i=(0,s.createContext)(void 0),d=()=>{let e=(0,s.useContext)(i);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e};function u(e){let{children:r}=e,[a,d]=(0,s.useState)([]),u=(0,s.useCallback)(e=>{let r=Math.random().toString(36).substring(2,9);d(a=>[...a,{...e,id:r}]),setTimeout(()=>{c(r)},e.duration||5e3)},[]),c=(0,s.useCallback)(e=>{d(r=>r.filter(r=>r.id!==e))},[]),g=(0,s.useCallback)(()=>{d([])},[]),m=e=>{switch(e){case"success":return(0,t.jsx)(l.A3x,{className:"w-5 h-5"});case"error":return(0,t.jsx)(l.y3G,{className:"w-5 h-5"});case"info":default:return(0,t.jsx)(l.S8s,{className:"w-5 h-5"});case"warning":return(0,t.jsx)(l.eHT,{className:"w-5 h-5"})}},p=e=>{switch(e){case"success":return"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200";case"error":return"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200";case"info":return"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200";default:return"bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200"}};return(0,t.jsxs)(i.Provider,{value:{showToast:u,hideToast:c,clearToasts:g},children:[r,(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 flex flex-col space-y-2 items-end",children:(0,t.jsx)(o.N,{children:a.map(e=>(0,t.jsx)(n.P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"".concat(p(e.type)," rounded-lg shadow-lg max-w-md pointer-events-auto"),children:(0,t.jsxs)("div",{className:"flex items-start p-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mr-3",children:m(e.type)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium",children:e.title}),e.message&&(0,t.jsx)("p",{className:"mt-1 text-sm opacity-90",children:e.message})]}),(0,t.jsx)("button",{onClick:()=>c(e.id),className:"ml-3 flex-shrink-0 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",children:(0,t.jsx)(l.yGN,{className:"w-5 h-5"})})]})},e.id))})})]})}},7547:(e,r,a)=>{a.d(r,{c:()=>u,O:()=>c});var t=a(5155),s=a(2115),o=a(3464);let n={login:"/api/auth/login",register:"/api/auth/register",me:"/api/auth/me",profile:"/api/users/me"},l=o.A.create({baseURL:"http://localhost:5000",headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let r=localStorage.getItem("token");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e));let i={register:async e=>{try{var r;let a=await l.post(n.register,e);return console.log("API register response:",a.data),a.data.token&&localStorage.setItem("token",a.data.token),{success:void 0===a.data.success||a.data.success,message:a.data.message,token:a.data.token,user:a.data.user||(null===(r=a.data.data)||void 0===r?void 0:r.user)||a.data.data}}catch(e){if(console.error("API register error:",e),o.A.isAxiosError(e)&&e.response)throw Error(e.response.data.message||"Registration failed");throw Error("Network error during registration")}},login:async e=>{try{var r,a,t;console.log("Login request:",e);let s=await l.post(n.login,e);console.log("API login raw response:",s),console.log("API login response.data:",s.data);let o=null,i=null;if((null===(r=s.data.data)||void 0===r?void 0:r.token)?(o=s.data.data.token,i=s.data.data.user):s.data.token?(o=s.data.token,i=s.data.user):(null===(t=s.data.data)||void 0===t?void 0:null===(a=t.user)||void 0===a?void 0:a.token)&&(o=s.data.data.user.token,i=s.data.data.user),!i){if(s.data.user)i=s.data.user;else if(s.data.data&&"object"==typeof s.data.data)i=s.data.data.user||s.data.data;else{let e=s.data;e&&e._id&&(i=e)}}if(console.log("Extracted token:",o),console.log("Extracted user data:",i),!o)throw console.error("No token found in response:",s.data),Error("Login failed: No authentication token returned");if(!i)throw console.error("No user data found in response:",s.data),Error("Login failed: No user data returned");return{success:void 0===s.data.success||s.data.success,message:s.data.message||"Login successful",token:o,user:i||null}}catch(e){if(console.error("API login error:",e),o.A.isAxiosError(e)){if(e.response)throw console.error("Server response error data:",e.response.data),Error(e.response.data.message||e.response.data.error||"Login failed");if(e.request)throw console.error("No response received:",e.request),Error("Network error: No response from server")}throw Error(e instanceof Error?e.message:"Login failed")}},logout:async()=>{localStorage.removeItem("token"),sessionStorage.removeItem("token")},getCurrentUser:async()=>{let e=[];try{console.log("Attempting to get current user from:",n.me);let e=await l.get(n.me);console.log("getCurrentUser response from primary endpoint:",e.data);let r=null;if(e.data.user?r=e.data.user:e.data.data&&"object"==typeof e.data.data?r=e.data.data.user||e.data.data:e.data&&e.data._id&&(r=e.data),r)return r}catch(r){e.push(r instanceof Error?r:Error("Unknown error")),console.error("Error with primary endpoint:",r)}try{console.log("Attempting to get current user from:",n.profile);let e=await l.get(n.profile);console.log("getCurrentUser response from secondary endpoint:",e.data);let r=null;if(e.data.user?r=e.data.user:e.data.data&&"object"==typeof e.data.data?r=e.data.data.user||e.data.data:e.data&&e.data._id&&(r=e.data),r)return r}catch(r){e.push(r instanceof Error?r:Error("Unknown error")),console.error("Error with secondary endpoint:",r)}return console.error("All getCurrentUser endpoints failed:",e),console.log("Using fallback user data"),{_id:"guest",name:"Guest User",email:"guest@example.com",role:"user",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},updateProfile:async e=>{try{let r=new FormData;return e.name&&r.append("name",e.name),e.email&&r.append("email",e.email),e.avatar&&r.append("avatar",e.avatar),(await l.put("/users/profile",r,{headers:{"Content-Type":"multipart/form-data"}})).data.user}catch(e){if(o.A.isAxiosError(e)&&e.response)throw Error(e.response.data.message||"Failed to update profile");throw Error("Network error during profile update")}},requestPasswordReset:async e=>{try{return(await l.post("/auth/forgot-password",{email:e})).data}catch(e){if(o.A.isAxiosError(e)&&e.response)throw Error(e.response.data.message||"Failed to request password reset");throw Error("Network error during password reset request")}}};var d=a(5695);let u=(0,s.createContext)(void 0);function c(e){let{children:r}=e,[a,o]=(0,s.useState)(null),[n,l]=(0,s.useState)(null),[c,g]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),h=(0,d.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(e){if(console.log("Token found in storage, attempting to retrieve user data"),l(e),e.startsWith("demo-token-")&&r){console.log("Demo token detected, using stored user data");try{let e=JSON.parse(r);o(e),g(!1);return}catch(e){console.error("Error parsing stored demo user:",e)}}try{let e=await i.getCurrentUser();e&&"guest"!==e._id?(console.log("Successfully retrieved user data",e),o({id:e._id,name:e.name,email:e.email,role:e.role,avatar:e.avatar,membershipLevel:e.membershipLevel})):(console.log("Invalid user data or guest user, clearing token"),localStorage.removeItem("token"),l(null))}catch(e){console.error("Failed to get user data despite having token:",e),localStorage.removeItem("token"),l(null)}}else console.log("No token found in storage")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("token"),l(null)}finally{g(!1)}})()},[]);let f=(0,s.useCallback)(()=>{p(null)},[]),v=(0,s.useCallback)(async(e,r,a)=>{g(!0),p(null);try{console.log("AuthProvider: Attempting login for",e);let a=await i.login({email:e,password:r});console.log("AuthProvider: Login response received:",JSON.stringify({success:a.success,message:a.message,hasToken:!!a.token,hasUser:!!a.user}));let t=a.user||null;if(t&&a.token){console.log("AuthProvider: Login successful, setting token and user data"),localStorage.setItem("token",a.token),l(a.token);let e={id:t._id,name:t.name,email:t.email,role:t.role||"user",avatar:t.avatar,membershipLevel:t.membershipLevel||"free"};console.log("AuthProvider: Setting user with roles:",e.role),o(e),setTimeout(()=>{h.push("/dashboard")},1500)}else throw console.error("AuthProvider: Invalid response, missing token or user data",{hasToken:!!a.token,hasUser:!!a.user}),Error("Invalid response from server")}catch(r){console.error("AuthProvider: Login error:",r);let e="Login failed";if(r instanceof Error){let a=r.message.toLowerCase();e=a.includes("email")&&a.includes("valid")?"Please provide a valid email address":a.includes("password")&&a.includes("incorrect")?"Incorrect password":a.includes("not found")||a.includes("not exist")?"Account not found with this email":a.includes("invalid credentials")||a.includes("invalid login")?"Invalid email or password":r.message}throw console.error("AuthProvider: Setting error message:",e),p(e),r}finally{g(!1)}},[h]),k=(0,s.useCallback)(async(e,r,a)=>{g(!0),p(null);try{let t=await i.register({name:e,email:r,password:a});console.log("Register response:",t);let s=t.user||null;if(s){let e={id:s._id,name:s.name,email:s.email,role:s.role||"user",avatar:s.avatar,membershipLevel:s.membershipLevel||"free"};o(e),setTimeout(()=>{h.push("/dashboard")},1500)}else throw console.error("Register response missing user data:",t),Error("Registration failed: User data missing in server response")}catch(r){console.error("Register error:",r);let e="Registration failed";if(r instanceof Error){let a=r.message.toLowerCase();e=a.includes("email")&&a.includes("valid")?"Please provide a valid email address":a.includes("email")&&(a.includes("exists")||a.includes("already")||a.includes("taken"))?"This email is already registered":a.includes("password")&&a.includes("length")?"Password must be at least 6 characters":a.includes("name")&&a.includes("required")?"Name is required":r.message}throw p(e),r}finally{g(!1)}},[h]),w=(0,s.useCallback)(async()=>{g(!0);try{n&&n.startsWith("demo-token-")?console.log("Logging out demo user"):n&&await i.logout(),localStorage.removeItem("token"),localStorage.removeItem("user"),l(null),o(null),h.push("/")}catch(e){console.error("Logout error:",e)}finally{g(!1)}},[h,n]),y=(0,s.useCallback)(async e=>{g(!0),p(null);try{await i.requestPasswordReset(e)}catch(e){throw p(e instanceof Error?e.message:"Password reset failed"),e}finally{g(!1)}},[]),x=(0,s.useCallback)(async e=>{g(!0),p(null);try{let r={name:e.name,email:e.email},a=await i.updateProfile(r);a&&o(e=>e?{...e,name:a.name,email:a.email,avatar:a.avatar,membershipLevel:a.membershipLevel}:null)}catch(e){throw p(e instanceof Error?e.message:"Profile update failed"),e}finally{g(!1)}},[]);return(0,t.jsx)(u.Provider,{value:{user:a,token:n,isLoading:c,error:m,login:v,register:k,logout:w,resetPassword:y,updateProfile:x,clearError:f},children:r})}}}]);